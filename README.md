# Рекомендация по проверки работы
*OLD_DEBUG* определяет режим отладки. Если закоментирован то режим отладки выключен, иначе включен.

Каждый клас имеет свой define для отладки:

*DEBUG_INDEXER* - для проверки работы класса [Indexer](#Индексация)

*DEBUG_DATABASE* - для проверки работы класса [Database](#База-данных)

*DEBUG_HTTPCLIENT* - для проверки HTTP клиента [HTTPClientSinc](#HTTP-клиент)

# Индексация
Для работы с индексацией применяется класс Indexer, пространства имен SPIDER.

Класс Indexer имеет следующие поля:
| Имя поля           | Тип значений | Комментарий|
|--------------------|--------------|------------|
| wordFrequency_     | map<std::string, int> | Определяет число повторений слов на странице|
| originPageHTML_    | std::string           | Содержит оригенальный текст страницы без HTML тегов|
| formattedPageHTML_ | std::string           | Содержит отформитированный текст страницы   |
| html_              | std::string           | Содержит текст страницы страницы|
| url_               | std::string           | Содержит ссылку на текущую страницу|
| cleaningHTMLTags_  | CleaningHTMLTags      | Предоставляет интерфейс для очистки HTML документа от тегов, смотри описание класса [CleaningHTMLTags](#Класс-для-очистки-тегов)|
| linksOnTheCurrentSite| std::vector         | Содержит url страниц найденных на данном сайте|
| database_          | Database         | Поле типа [Database](#База-данных)|

Класс Indexer имеет следующие методы: 
| Имя метода                | Тип принимаемого/возвращаемого значения | Комментарий|
|---------------------------|-----------------------------------------|------------|
| pageRequestHTML           | std::string / void | Открывает файл HTML, и удаляет все теги|
| convertWordsLowerCase     | void / void        | Приводит текст к нижнему регистру|
| wordFrequencyAnalysisText | void / void        | Заполняет wordFrequency_ |
| saveDataDatabase          | void / void        | Сохраняет данные в таблицу|
| setData                   | void / void        | Сохраняет данные в таблицу, однако вероятно этот метод будет выполнятся асинхронно|
| **execute**               | const std::string& URL, const std::string& html / void | Основной метод. Имено его нужно вызвать что бы началась работа класса, он сформирует wordFrequency_ и linksOnTheCurrentSite, а так же сохраняет данные в БД, URL - ссылка на страницу, html - текст страницы|
| getLinksOnTheCurrentSite  | void / std::vector | Возвращает вектор ссылок найденных на текущем сайте|

## Класс для очистки тегов
Класс **CleaningHTMLTags** предназначен для очистки файла от тегов. Основные методы:

 **std::string execute(const std::string& input)**, который возвращает отформитированную строку, а в качестве параметра получает строку.

 **std::string getURL(const std::string& html)**, который очищает строку от тегов и в случае если есть ссылка возвращает ее, в противном случае возвращает "".
В констрeкторе можно переопределить регулярное выражение по которому очищается файл от тегов. Для этого необходимо переопределить регулярное выражение **tags** - для очистки тегов, **hrefTegs** - для очистки ссылок.


# База данных
## Структура для инициализации данных для подключения к БД
В пространсте имен SPIDER имеется структура BDSetup, которая в коснтруктор принимает ini файл (ini.txt), и считывает:
1. Хост (адрес) базы данных;
2. Порт, на котором запущена база данных;
3. Название базы данных;
4. Имя пользователя для подключения к базе данных;
5. Пароль пользователя для подключения к базе данных;

Данная структура предназначена только для считывание ини файла. Единственно публичное поле данной структуры **std::string dataSetup_** , которое предназначено для передачи его в конструктор класса **Database**

## Создание базы данных
Структура базы данных для обработки полученных слов имеет следующий вид:

<div align="center">

![Структура БД](БД.jpg)
</div>

<div align="center">
Структура БД
</div>

Класс **Database** предназначн для работы с БД он имеет следующие методы:

**Публичные методы**:
| Имя метода                | Тип принимаемого/возвращаемого значения | Комментарий|
|---------------------------|-----------------------------------------|------------|
| Database                  | std::string / void | Конструктор, принимает данные считынные с ini файла с помощью структуры [BDSetup](#Структура-для-инициализации-данных-для-подключения-к-БД)|
| createTables              | void / void        | Создается таблицы со связями в соответсвии с рисунком выше (Структура БД)|
| deleteTables              | void / void        | Удаляет все таблицы из БД |
| writeDataToTable          | const std::string& url, const std::map<std::string, int>& wordFrequency / void        | Сохраняет данные в таблицу|
| checkingForURLExistence   | const std::string& url / bool        | Возвращает true если данная сылка уже существует в БД, данный метод необходимо использовать в класса  [Indexer](#Индексация), в методе execute, перед началом обработки сайта|

_На данный момент подразумевается, что класс [Indexer](#Индексация) передаст параметры в метод writeDataToTable._

**Приватные методы**:
| Имя метода   | Тип принимаемого/возвращаемого значения | Комментарий|
|------------|-----------------------------------------|------------|
| addURL     | const std::string& / int | Записывает URL в БД, возвращает id сайта в БД|
| addWord    | const std::string& / int | Записывает слово в БД если его там не было, возвращает id слова в БД|
| insertOrUpdateFrequency | int document_id, int word_id, int frequency / void | Записывет или обновляет число повторений одного слова на сайте |




**Возможно в этом же классе необходимо реализовать логику для чтеия данных с БД**

# HTTP-клиент
http-клиент сделан полностью на основе [примера](https://www.boost.org/doc/libs/1_82_0/libs/beast/doc/html/beast/quick_start/http_client.html)

Для использования HTTP-клиента используется класс **HTTPClientSinc**

**Методы**
| Имя метода                | Тип принимаемого/возвращаемого значения | Комментарий|
|---------------------------|-----------------------------------------|------------|
| HTTPClientSinc            | std::string host, std::string port = "80", int http_version = 11 / - | Конструктор, определяет host, port (80), и версию http (11)|
| get                       | const std::string& target, std::string& out_body, std::string& out_error / bool | Выполняет get запрос на сайе http, указанный в коснтрукторе (host). Возвращает true При успешном запросе, иначе false. В переменную out_body запишется ответ http сервреа|

**Поля**
| Имя поля           | Тип значений | Комментарий|
|--------------------|--------------|------------|
| host_              | std::string  | содержит хост страницы|
| port_              | std::string  | Содержит порт для отправки запроса, для http запросы используется порт 80|
| http_version_      | int          | Версия http   |
| ioc_               | net::io_context   | Используется для обработки событий ввода-вывода|
| resolver_          | tcp::resolver     | При передаче имени хоста (host_) резолвер выполняет запрос в DNS, чтобы определить, куда подключаться   |
| stream_            | beast::tcp_stream | Позволяет устанавливать соединение по IP/порту, отправлять и принимать данные с помощью HTTP протокола|

# Паук
Объединяет классы [Indexer](#Индексация), [Database](#База-данных), [HTTPClientSinc](#HTTP-клиент) для асинхронного запроса к сайтам и записи данных в базу данных.

Для инициализации класса используется вспомогательная структура [SpiderSetup](#Структура-для-инициализации-класса)



## Структура для инициализации класса [Spider](#Паук)
Структура предназначена для чтения ini файла и в дальнейшем передачи полученных данных в класс [Spider](#Паук).
Передайте ini файл в конструктор. В качестве публичных полей используйте:

**Поля**
| Имя поля           | Тип значений | Комментарий|
|--------------------|--------------|------------|
| dataSetupBD_       | std::string  | Содержит данные для подключения к БД|
| startPage_         | std::string  | Содержит стартовый url страницы|
| depthRecursion_    | int          | Глубина рекурсии   |